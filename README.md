# Flower Shop Telegram Bot 

Telegram бот для цветочного магазина с интеграцией Google Docs для базы знаний, использованием OpenAI для генерации ответов и Supabase для хранения данных.

## Обзор проекта

Бот автоматизирует обработку частых вопросов клиентов цветочного магазина, отвечая на типичные вопросы о доставке, ценах и наличии цветов, а также собирает данные для улучшения сервиса.

### Цели проекта
1. Быстрые и естественные ответы на вопросы через Telegram
2. Сбор и анализ вопросов клиентов для улучшения сервиса
3. Интеграция с базами данных для актуальной информации
4. Автоматическая обработка часто задаваемых вопросов

## Основной функционал

### Работа с клиентами
- Естественное общение с клиентами:
  - Понимание контекста диалога
  - Персонализированные ответы
  - Мультиязычная поддержка (RU, KK, EN)
- Интеллектуальный поиск по базе знаний
- Автоматическое определение языка
- Кэширование частых вопросов

### Интеграции
- **Google Docs**
  - База знаний с ответами на вопросы
  - Совместное редактирование контента
  - Автоматическое обновление информации
- **OpenAI**
  - Генерация естественных ответов
  - Обработка сложных запросов
  - Поддержка контекста разговора
- **Supabase**
  - Хранение учетных данных
  - Кэширование ответов
  - Статистика использования
  - Логирование взаимодействий

## Структура проекта

```
flower_shop_bot/
├── src/                    # Основной код проекта
│   ├── telegram_bot.py     # Основной файл бота
│   ├── services/          # Сервисные модули
│   │   ├── docs_service.py  # Работа с Google Docs
│   │   ├── cache_service.py # Кэширование и статистика
│   │   ├── supabase_service.py # Работа с базой данных
│   │   └── config_service.py   # Управление конфигурацией
│   └── scripts/           # Скрипты для обслуживания
│       └── init_knowledge_base.py # Инициализация базы знаний
├── supabase/             # Конфигурация Supabase
│   └── migrations/       # Миграции базы данных
└── docs/                 # Документация
    ├── credentials.md    # Управление учетными данными
    └── roadmap.md        # План развития
```

## Установка и настройка

### 1. Подготовка окружения

1. Клонируйте репозиторий:
   ```bash
   git clone [repository-url]
   cd flower_shop_bot
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

### 2. Настройка базы данных

1. Примените миграции:
   ```bash
   psql $SUPABASE_URL -f supabase/migrations/20241220_create_chat_tables.sql
   ```

2. Настройте учетные данные в таблице `credentials`:
   - OpenAI API
   - Telegram Bot Token
   - Google Service Account

### 3. Инициализация базы знаний

1. Создайте документ базы знаний:
   ```bash
   python3 src/scripts/init_knowledge_base.py
   ```

2. Заполните базу знаний через Google Docs:
   - Информация о магазине
   - Часто задаваемые вопросы
   - Условия доставки
   - Способы оплаты

## Мониторинг и статистика

### Таблицы для анализа
- `cache_answers` - кэшированные ответы
- `chat_statistics` - статистика диалогов
- `chat_context` - контекст диалогов

### Основные метрики
1. Эффективность кэша:
   ```sql
   SELECT 
     COUNT(*) as total_queries,
     SUM(CASE WHEN was_cached THEN 1 ELSE 0 END) as cached_hits,
     AVG(response_time_ms) as avg_response_time
   FROM chat_statistics;
   ```

2. Популярные вопросы:
   ```sql
   SELECT question, hits 
   FROM cache_answers 
   ORDER BY hits DESC 
   LIMIT 5;
   ```

## Обслуживание

### Очистка данных
- Контекст диалогов очищается автоматически через 1 час
- Неиспользуемые кэшированные ответы удаляются через 7 дней

### Обновление базы знаний
1. Отредактируйте документ в Google Docs
2. Изменения применяются автоматически

## План развития

Текущий план развития проекта доступен в [docs/roadmap.md](docs/roadmap.md).

## Лицензия

MIT License. См. файл LICENSE для деталей.
