# Flower Shop Telegram Bot 

Telegram бот для цветочного магазина с интеграцией Google Sheets для управления инвентарем и использованием OpenAI для генерации ответов.

## Обзор проекта

Бот автоматизирует обработку частых вопросов клиентов цветочного магазина, отвечая на типичные вопросы о доставке, ценах и наличии цветов, а также собирает данные для улучшения сервиса.

### Цели проекта
1. Быстрые ответы на базовые вопросы через Telegram
2. Сбор и анализ вопросов клиентов для улучшения сервиса
3. Интеграция с базами данных для актуальной информации

## Основной функционал

### Работа с клиентами
- Ответы на частые вопросы:
  - Цены на букеты
  - График работы
  - Условия доставки
  - Способы оплаты
- Поиск и предоставление информации о товарах
- Обработка специальных запросов

### Интеграции
- **Google Sheets**
  - Синхронизация каталога товаров
  - Управление инвентарем
  - Обновление цен и наличия
- **OpenAI**
  - Генерация естественных ответов
  - Обработка сложных запросов
  - Поддержка контекста разговора
- **Supabase**
  - Хранение данных пользователей
  - Логирование взаимодействий
  - Кэширование ответов

## Структура проекта

```
flower_shop_bot/
├── src/                      # Основной код проекта
│   ├── bot/                  # Модули Telegram бота
│   │   ├── handlers.py      # Обработчики сообщений
│   │   └── bot.py          # Основной класс бота
│   ├── services/            # Сервисные модули
│   │   ├── google_service.py   # Работа с Google Sheets
│   │   ├── supabase_service.py # Работа с базой данных
│   │   ├── credentials_service.py # Управление учетными данными
│   │   ├── config_service.py   # Управление конфигурацией
│   │   └── inventory_service.py # Управление инвентарем
│   └── utils/               # Вспомогательные модули
│       └── logger.py        # Система логирования
├── db/                      # База данных
│   └── migrations/          # Миграции базы данных
├── .env                     # Переменные окружения
└── requirements.txt         # Зависимости проекта
```

## Установка и настройка

1. Клонируйте репозиторий
2. Создайте и настройте `.env` файл:
   ```
   # Telegram
   TELEGRAM_BOT_TOKEN_DEV=your_token
   
   # OpenAI
   OPENAI_API_KEY=your_key
   
   # Supabase
   SUPABASE_DB_NAME=your_db_name
   SUPABASE_DB_USER=your_db_user
   SUPABASE_DB_PASSWORD=your_db_password
   SUPABASE_DB_HOST=your_db_host
   SUPABASE_DB_PORT=your_db_port
   
   # Google
   GOOGLE_SPREADSHEET_ID=your_id
   ```
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Запустите бота:
   ```bash
   python3 src/telegram_bot.py
   ```

## Последние изменения

### Добавлено
- Обработка превышения лимита запросов к OpenAI API
- Система отслеживания истории разговоров
- Расширенное логирование в Telegram канал
- Новая система управления учетными данными через базу данных

### Улучшено
- Оптимизирована работа с контекстом разговора
- Улучшена система обработки ошибок
- Обновлена структура логирования
- Повышена безопасность хранения учетных данных

## Развитие проекта

Текущие планы по развитию:
1. Оптимизация промптов для более точных ответов
2. Расширение интеграции с Google Sheets
3. Улучшение системы логирования и мониторинга
4. Добавление новых функций для работы с заказами

## Документация

Дополнительная документация:
- [workflow.md](workflow.md) - Описание работы бота
- [TODO.md](TODO.md) - Список задач и планы развития

## Безопасность

- Все чувствительные данные хранятся в `.env` файле
- Настроены правила `.gitignore`
- Регулярное обновление зависимостей
